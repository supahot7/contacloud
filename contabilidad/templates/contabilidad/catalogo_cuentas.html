{% extends 'base.html' %}
{% load static %}

{% block title %}Cat√°logo de Cuentas{% endblock %}

{% block content %}
<div class="container py-4">

    <!-- Header -->
    <div class="mb-4 text-center">
        <h1 class="display-5">Cat√°logo de Cuentas</h1>
        <p class="lead">Gesti√≥n del plan de cuentas contables</p>
    </div>

    <!-- Controles -->
    <div class="row mb-3 g-2 align-items-center">
        <div class="col-md-4">
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-search"></i></span>
                <input type="text" id="buscar" class="form-control" placeholder=" Buscar cuenta o c√≥digo">
            </div>
        </div>
        <div class="col-md-3">
            <select id="filtro-tipo" class="form-select">
                <option value="todos">Todos</option>
                <option value="activo">Activo</option>
                <option value="pasivo">Pasivo</option>
                <option value="capital">Capital</option>
                <option value="ingresos">Ingresos</option>
                <option value="gastos">Gastos</option>
            </select>
        </div>
        <div class="col-md-2">
            <button class="btn btn-primary w-100">+ Nueva Cuenta</button>
        </div>
    </div>

    <!-- Tabla de cuentas -->
    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
            <thead class="table-dark">
                <tr>
                    <th>C√≥digo</th>
                    <th>Nombre</th>
                    <th>Tipo</th>
                    <th>Descripci√≥n</th>
                    <th>Cuenta Padre</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for cuenta in cuentas %}
                <tr>
                    <td><strong>{{ cuenta.codigo }}</strong></td>
                    <td>{{ cuenta.nombre }}</td>
                    <td>
                        <span class="badge 
                            {% if cuenta.tipo == 'Activo' %}bg-primary
                            {% elif cuenta.tipo == 'Pasivo' %}bg-warning
                            {% elif cuenta.tipo == 'Capital' %}bg-success
                            {% elif cuenta.tipo == 'Ingresos' %}bg-info
                            {% elif cuenta.tipo == 'Gastos' %}bg-danger
                            {% else %}bg-secondary{% endif %}">
                            {{ cuenta.tipo }}
                        </span>
                    </td>
                    <td>
                        {% if cuenta.descripcion %}
                            {{ cuenta.descripcion }}
                        {% else %}
                            <span class="text-muted">Sin descripci√≥n</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if cuenta.cuenta_padre %}
                            {{ cuenta.cuenta_padre.codigo }} - {{ cuenta.cuenta_padre.nombre }}
                        {% else %}
                            <span class="text-muted">Cuenta principal</span>
                        {% endif %}
                    </td>
                    <td>
                        <button class="btn btn-sm btn-warning me-1">‚úèÔ∏è Editar</button>
                        <button class="btn btn-sm btn-danger">üóëÔ∏è Eliminar</button>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center py-4">
                        <div class="text-muted">
                            <i class="bi bi-inbox" style="font-size: 2rem;"></i>
                            <p class="mt-2">No hay cuentas registradas en el cat√°logo.</p>
                            <button class="btn btn-primary mt-2">+ Agregar primera cuenta</button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>

<!-- JavaScript para b√∫squeda y filtros -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const buscarInput = document.getElementById('buscar');
    const filtroTipo = document.getElementById('filtro-tipo');
    const filas = document.querySelectorAll('tbody tr');
    
    function filtrarCuentas() {
        const textoBusqueda = buscarInput.value.toLowerCase();
        const tipoSeleccionado = filtroTipo.value;
        
        filas.forEach(fila => {
            const codigo = fila.cells[0].textContent.toLowerCase();
            const nombre = fila.cells[1].textContent.toLowerCase();
            const tipo = fila.cells[2].textContent.toLowerCase();
            
            const coincideBusqueda = codigo.includes(textoBusqueda) || nombre.includes(textoBusqueda);
            const coincideTipo = tipoSeleccionado === 'todos' || tipo.includes(tipoSeleccionado);
            
            if (coincideBusqueda && coincideTipo) {
                fila.style.display = '';
            } else {
                fila.style.display = 'none';
            }
        });
    }
    
    buscarInput.addEventListener('input', filtrarCuentas);
    filtroTipo.addEventListener('change', filtrarCuentas);
});
</script>

<style>
.badge {
    font-size: 0.75em;
}
</style>
{% endblock %}