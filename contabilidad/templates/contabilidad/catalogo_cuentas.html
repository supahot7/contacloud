{% extends 'base.html' %}
{% load static %}

{% block title %}Catálogo de Cuentas{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/contabilidad/catalogoCuentas.css' %}">
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="mb-4 text-center">
        <h1 class="display-5">Catálogo de Cuentas</h1>
    </div>

    <!-- Filtros -->
    <div class="row mb-3 g-2 align-items-center">
        <div class="col-md-4">
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-search"></i></span>
                <input type="text" id="buscar" class="form-control" placeholder="Buscar cuenta o código...">
            </div>
        </div>
        <div class="col-md-3">
            <select id="filtro-tipo" class="form-select">
                <option value="todos">Todos los tipos</option>
                <option value="activo">Activo</option>
                <option value="pasivo">Pasivo</option>
                <option value="capital">Capital</option>
                <option value="ingresos">Ingresos</option>
                <option value="gastos">Gastos</option>
            </select>
        </div>
    </div>

    <!-- Tabla -->
    <div class="table-responsive">
        <table class="table table-hover align-middle" id="tabla-cuentas">
            <thead class="table-dark">
                <tr>
                    <th>Código</th>
                    <th>Nombre</th>
                    <th>Descripción</th>
                </tr>
            </thead>
            <tbody id="cuerpo-tabla">
                {% for cuenta in cuentas %}
                <tr data-tipo="{{ cuenta.tipo }}">
                    <td>{{ cuenta.codigo }}</td>
                    <td>{{ cuenta.nombre }}</td>
                    <td>{{ cuenta.descripcion }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" class="text-center text-muted">No hay cuentas registradas.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", function () {
    const buscarInput = document.getElementById("buscar");
    const filtroSelect = document.getElementById("filtro-tipo");
    const filas = document.querySelectorAll("#cuerpo-tabla tr");

    function filtrar() {
        const texto = buscarInput.value.toLowerCase();
        const tipoSeleccionado = filtroSelect.value;

        filas.forEach(fila => {
            const codigo = fila.cells[0].textContent.toLowerCase();
            const nombre = fila.cells[1].textContent.toLowerCase();
            const tipo = fila.getAttribute("data-tipo");

            const coincideTexto = codigo.includes(texto) || nombre.includes(texto);
            const coincideTipo = tipoSeleccionado === "todos" || tipo === tipoSeleccionado;

            fila.style.display = (coincideTexto && coincideTipo) ? "" : "none";
        });
    }

    buscarInput.addEventListener("input", filtrar);
    filtroSelect.addEventListener("change", filtrar);
});
</script>
{% endblock %}
